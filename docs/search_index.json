[["03-rendimientos.html", "3 Rendimientos 3.1 Rindes observados 3.2 Brechas", " 3 Rendimientos knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, googlesheets4, googledrive) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) dat %&gt;% drop_na(rinde) %&gt;% group_by(campana, Zona, cultivo_de_cosecha) %&gt;% summarise(n_lotes = n(), rinde_med = quantile(rinde, 0.5), techo = quantile(rinde, 0.95)) -&gt; lotes dat %&gt;% drop_na(rinde) %&gt;% filter(!campana == &quot;20-21&quot;) %&gt;% group_by(Zona, cultivo_de_cosecha) %&gt;% summarise(rinde_med = quantile(rinde, 0.5)) -&gt; lotes_sum 3.1 Rindes observados (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Trigo&quot; , fill = &quot;&quot;)+ # scale_y_continuous(breaks= scales::pretty_breaks())+ geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ # geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=techo), col = &quot;red&quot;)+ guides(fill = &quot;none&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_hist_tr.png&quot;, width = 5, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/rindes_hist_tr.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% droplevels() %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Trigo&quot; , fill = &quot;&quot;)+ scale_x_continuous(breaks= scales::pretty_breaks())+ # 2020 geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;, campana == &quot;20-21&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ # serie geom_vline(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=rinde_med), col = &quot;green&quot;)+ geom_text(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Trigo&quot;), aes(x=rinde_med, y=-Inf, label=round(rinde_med,0)), vjust=-1,col = &quot;green&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;, campana == &quot;20-21&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ labs( caption = &quot;- Mediana 2017-2019: línea verde\\n- Mediana 2020-21: línea roja&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_20_serie_tr.png&quot;, width = 4, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rindes_20_serie_tr.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Cebada&quot;)+ geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ scale_y_continuous(breaks= scales::pretty_breaks())+ theme_aapre) # last_plot() %&gt;% # ggsave(file = &quot;plots/rindes_hist_ceb.png&quot;, width = 5, height = 4) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/rindes_hist_ceb.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% droplevels() %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Cebada&quot; , fill = &quot;&quot;)+ scale_x_continuous(breaks= scales::pretty_breaks())+ # 2020 geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;, campana == &quot;20-21&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ # serie geom_vline(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Cebada&quot;), aes(xintercept=rinde_med), col = &quot;green&quot;)+ geom_text(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Cebada&quot;), aes(x=rinde_med, y=-Inf, label=round(rinde_med,0)), vjust=-1,col = &quot;green&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;, campana == &quot;20-21&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ labs( caption = &quot;- Mediana 2017-2019: línea verde\\n- Mediana 2020-21: línea roja&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_20_serie_ceb.png&quot;, width = 4, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rindes_20_serie_ceb.png&quot;, overwrite = TRUE) 3.2 Brechas potencial &lt;- dat %&gt;% mutate_if(is.character, as.factor) %&gt;% filter(cultivo_de_cosecha %in% c(&quot;Trigo&quot;, &quot;Cebada&quot;)) %&gt;% filter(dano_tot &lt; 10, rinde &gt; 1000) %&gt;% # riego == &quot;NO&quot;) %&gt;% group_by(Zona, campana, cultivo_de_cosecha) %&gt;% summarise(.groups = &#39;drop&#39;, lotes = n(), rinde_50 = quantile(rinde, 0.5, na.rm = TRUE), rinde_90 = quantile(rinde, 0.90, na.rm = TRUE), rinde_95 = quantile(rinde, 0.95, na.rm = TRUE), dif = round((rinde_95-rinde_50)/rinde_95*100,1), label = paste(round(dif, 0), &quot;%&quot;, sep=&quot;&quot;), n_lotes = paste(&quot;(&quot;, round(lotes, 1), &quot;)&quot;, sep=&quot;&quot;)) %&gt;% complete(Zona, nesting(campana, cultivo_de_cosecha)) # potencial %&gt;% # write_sheet(ss=jmf, sheet = &quot;potencial&quot;) # potencial%&gt;% view ggplot(potencial) + facet_wrap(&quot;campana&quot;)+ geom_bar(aes(x=Zona, y=rinde_90, fill = cultivo_de_cosecha), position=position_dodge(width=0.9), stat=&quot;identity&quot;, alpha=0.5)+ geom_text(aes(Zona, rinde_90, fill = cultivo_de_cosecha, label=round(rinde_90,0)), stat=&quot;identity&quot;, position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3)+ geom_bar(aes(x=Zona, y=rinde_50, fill = cultivo_de_cosecha), position=position_dodge(width=0.9), stat=&quot;identity&quot;)+ geom_text(aes(Zona, rinde_50, fill = cultivo_de_cosecha, label=round(rinde_50,0)), position=position_dodge(width=0.9), vjust = 1, hjust=0.5, size = 3)+ labs(x = &quot;&quot;, y = &quot;kg/ha&quot;, title = &quot;Rendimientos 50° y 90°&quot;, fill = &quot;&quot;, caption = &quot;- Barras: 50° y 90° percentil\\n - Excuidos: daño por adversidades &gt; 10%, rinde &lt; 1000 kg/ha\\n - Numero de lotes entre paréntesis&quot; )+ scale_y_continuous(breaks= scales::pretty_breaks(), expand = c(0.2, 0))+ theme_bw2 # ggsave(last_plot(), file = &quot;plots/potencial_tr_ceb.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/potencial_tr_ceb.png&quot;, overwrite = TRUE) potencial %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% ggplot() + facet_wrap(&quot;campana&quot;)+ geom_bar(aes(x=Zona, y=rinde_95), # position=position_dodge(width=0.9), stat=&quot;identity&quot;, fill = alpha(&quot;#ff1212&quot;, 0.5))+ geom_text(aes(Zona, rinde_95, # fill = cultivo_de_cosecha, label=round(rinde_95,0)), stat=&quot;identity&quot;, # position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3)+ geom_bar(aes(x=Zona, y=rinde_50), # position=position_dodge(width=0.9), stat=&quot;identity&quot;, fill = alpha(&quot;#1212ff&quot;, 0.5) )+ geom_text(aes(Zona, rinde_50, # fill = cultivo_de_cosecha, label=round(rinde_50,0)), # position=position_dodge(width=0.9), vjust = 1, hjust=0.5, size = 3)+ geom_text(aes(Zona, y=((rinde_95-rinde_50)/2)+rinde_50, # fill = cultivo_de_cosecha, label=label), # position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3, fontface=&quot;bold&quot;)+ geom_text(aes(Zona, y=-Inf, # fill = cultivo_de_cosecha, label=n_lotes), # position=position_dodge(width=0.9), vjust = -2, hjust=0.5, size = 3, fontface=&quot;bold&quot;)+ labs(x = &quot;&quot;, y = &quot;kg/ha&quot;, title = &quot;Potencial de rendimiento - Trigo&quot;, # fill = &quot;&quot;, caption = &quot;- Barras: percentiles 95° (rosa) y 50° (violeta)\\n- Excluidos: daño por adversidades &gt; 10%, rinde &lt; 1000 kg/ha\\n- Numero de lotes entre paréntesis&quot; )+ theme_dens1 # ggsave(last_plot(), file = &quot;plots/potencial_trigo.png&quot;, w=5, h=6) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/potencial_trigo.png&quot;, overwrite = TRUE) "]]
