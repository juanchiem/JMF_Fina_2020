[["index.html", "Modelo de análisis de campaña 1 Uso", " Modelo de análisis de campaña 2021-04-03 1 Uso "],["import.html", "2 Importacion", " 2 Importacion knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE) pacman::p_load(tidyverse, googlesheets4) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_find(&quot;JMF_2020&quot;) # jmf &lt;- gs4_get(&quot;1b3Zu9CT-B1lHVwkl7wLS_njDQyvwRFYnw_H-OjyO7LA&quot;) # gs4_browse(jmf) load(here::here(&quot;data/data.Rdata&quot;)) raw &lt;- read_sheet(jmf, sheet = &quot;raw&quot;, guess_max = 10000, skip=1) %&gt;% janitor::clean_names() #%&gt;% # mutate_if(is.character, as.factor) %&gt;% # mutate(fsiembra = lubridate::ymd(fsiembra)) # glimpse(raw) # summary(raw$superficie) wiki &lt;- read_sheet(jmf, sheet = &quot;wiki&quot;, guess_max = 10000, skip=0) # wiki %&gt;% view raw %&gt;% mutate(Zona = case_when( str_detect(zona_0, &quot;Madariaga|Maipú&quot;) ~ &quot;Madariaga&quot;, str_detect(zona_0, &quot;Balcarce&quot;) ~ &quot;Sierra&quot;, TRUE ~ &quot;Costa&quot; )) %&gt;% mutate( year = factor(lubridate::year(fecha_de_siembra_dia_mes)), date = update(fecha_de_siembra_dia_mes, year = 1), temprano_tardio= case_when( date&lt;as.Date(&quot;0001-07-15&quot;) ~ &quot;Temprano&quot;, date&gt;as.Date(&quot;0001-07-15&quot;) ~ &quot;Tardio&quot;)) %&gt;% mutate(across(c(&quot;localidad&quot;, &quot;variedad&quot;, &quot;antecesor_estival&quot;,&quot;fungicida1&quot;, &quot;fungicida2&quot;, &quot;enfermedad_1&quot;, &quot;enfermedad_2&quot;), #sacar acentos ~stringi::stri_trans_general( #pasar a mayusculas y sacar puntos str_to_upper(gsub(&#39;,&#39;, &#39;\\\\.&#39;, # sacar espacios antes-desp str_trim( str_replace_all(., fixed(&quot; &quot;), &quot;_&quot;) ))), &quot;Latin-ASCII&quot;))) %&gt;% rowwise() %&gt;% mutate(dano_tot = sum(dano_1,dano_2, na.rm = T)) %&gt;% ungroup-&gt; dat # glimpse(dat) # raw %&gt;% # slice(292:295) %&gt;% # select(contains(&quot;dano&quot;)) # save(raw,dat, file = &quot;data/data.Rdata&quot;) all_images &lt;- list.files(path = here::here(&quot;plots&quot;), pattern = &quot;.png&quot;, all.files = TRUE, full.names = TRUE) all_images %&gt;% map(~ drive_upload(., path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), overwrite = TRUE) ) Cantidad de datos/celdas vacias por variable dat %&gt;% summarise_all(funs(sum(!is.na(.)))) %&gt;% pivot_longer(everything(), names_to = &quot;variable&quot;, values_to = &quot;datos&quot;) %&gt;% left_join(by=&quot;variable&quot;, dat %&gt;% summarise_all(funs(sum(is.na(.)))) %&gt;% pivot_longer(everything(), names_to = &quot;variable&quot;, values_to = &quot;datos_faltantes&quot;) ) #%&gt;% # knitr::kable() %&gt;% # write_sheet(ss=jmf, sheet = &quot;faltantes&quot;) "],["superficies.html", "3 Superficies 3.1 Superficie por zona / campaña 3.2 Superficie de cultivos / zona", " 3 Superficies knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, googlesheets4, googledrive) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) load(here::here(&quot;data/data.Rdata&quot;)) # glimpse(dat) 3.1 Superficie por zona / campaña (dat %&gt;% group_by(Zona, campana) %&gt;% summarise(super = round(sum(superficie, na.rm = TRUE)/1000,1)) %&gt;% ungroup() %&gt;% mutate(campana = factor(campana), # campana = forcats::fct_rev(campana), zona = factor(Zona)) %&gt;% ggplot(aes( x = campana, # x = reorder(Zona, super, sum), y = super, fill = Zona)) + geom_bar(stat = &quot;identity&quot;, color = gray(.5)) + geom_text(aes(label = super), position = position_stack(vjust = 0.5), col = &quot;white&quot;, fontface = &quot;bold&quot;, size = 4)+ # coord_flip()+ labs(x = &quot;&quot;, y = &quot;miles de has&quot;, fill = &quot;&quot;, title = &quot;Superficie según campaña/zona&quot;)+ geom_text( aes( # x = reorder(Zona, super, sum), x = campana, label = stat(y), group = campana), stat = &#39;summary&#39;, fun = sum, angle = 0, vjust = -0.5, hjust=0.5, size = 4)+ scale_fill_viridis_d(begin = 0.3, end =1, direction = -1)+ lims(y=c(0,17))+ theme_bw2 ) ggsave(last_plot(), file = &quot;plots/sup_campana_zona.png&quot;, width = 7, height = 4) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/sup_campana_zona.png&quot;, overwrite = TRUE) 3.2 Superficie de cultivos / zona (dat %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% group_by(Zona, cultivo_de_cosecha) %&gt;% summarise(super = round(sum(superficie)/1000,1)) %&gt;% ungroup() %&gt;% mutate(Zona = factor(Zona), # campana = forcats::fct_rev(campana), cultivo_de_cosecha = factor(cultivo_de_cosecha)) %&gt;% filter(between(super, 0.1, 10000)) %&gt;% ggplot(aes( x =reorder(Zona, super, sum), y = super, fill = cultivo_de_cosecha)) + geom_bar(stat = &quot;identity&quot;, color = gray(.5)) + geom_text(aes(label = super), position = position_stack(vjust = 0.5), col = &quot;white&quot;, fontface = &quot;bold&quot;, size = 4)+ coord_flip()+ labs(x = &quot;&quot;, y = &quot;miles de has&quot;, fill = &quot;&quot;, title = &quot;Superficie de cultivos en 2020-21&quot;)+ geom_text( aes(x = reorder(Zona, super, sum), label = stat(y), group = Zona), stat = &#39;summary&#39;, fun = sum, angle = 270, vjust = -0.3, hjust=0.5, size = 4)+ scale_fill_viridis_d(begin = 0.3, end =1, direction = -1)+ theme_bw2 ) ggsave(last_plot(), file = &quot;plots/sup_cultivos.png&quot;, width = 7, height = 4) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/sup_cultivos.png&quot;, overwrite = TRUE) "],["rendimientos.html", "4 Rendimientos 4.1 Rindes observados 4.2 Brechas", " 4 Rendimientos knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, googlesheets4, googledrive) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) dat %&gt;% drop_na(rinde) %&gt;% group_by(campana, Zona, cultivo_de_cosecha) %&gt;% summarise(n_lotes = n(), rinde_med = quantile(rinde, 0.5), techo = quantile(rinde, 0.95)) -&gt; lotes dat %&gt;% drop_na(rinde) %&gt;% filter(!campana == &quot;20-21&quot;) %&gt;% group_by(Zona, cultivo_de_cosecha) %&gt;% summarise(rinde_med = quantile(rinde, 0.5)) -&gt; lotes_sum 4.1 Rindes observados (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Trigo&quot; , fill = &quot;&quot;)+ # scale_y_continuous(breaks= scales::pretty_breaks())+ geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ # geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=techo), col = &quot;red&quot;)+ guides(fill = &quot;none&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_hist_tr.png&quot;, width = 5, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/rindes_hist_tr.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% droplevels() %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Trigo&quot; , fill = &quot;&quot;)+ scale_x_continuous(breaks= scales::pretty_breaks())+ # 2020 geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;, campana == &quot;20-21&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ # serie geom_vline(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Trigo&quot;), aes(xintercept=rinde_med), col = &quot;green&quot;)+ geom_text(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Trigo&quot;), aes(x=rinde_med, y=-Inf, label=round(rinde_med,0)), vjust=-1,col = &quot;green&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Trigo&quot;, campana == &quot;20-21&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ labs( caption = &quot;- Mediana 2017-2019: línea verde\\n- Mediana 2020-21: línea roja&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_20_serie_tr.png&quot;, width = 4, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rindes_20_serie_tr.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Cebada&quot;)+ geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ scale_y_continuous(breaks= scales::pretty_breaks())+ theme_aapre) # last_plot() %&gt;% # ggsave(file = &quot;plots/rindes_hist_ceb.png&quot;, width = 5, height = 4) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/rindes_hist_ceb.png&quot;, overwrite = TRUE) (dat %&gt;% drop_na(rinde) %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% droplevels() %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(rinde))+ geom_histogram(fill = &quot;steelblue&quot;)+ facet_grid(Zona ~ campana)+ labs(y = &quot;Cantidad de lotes&quot;, x = &quot;kg/ha&quot;, title =&quot;Cebada&quot; , fill = &quot;&quot;)+ scale_x_continuous(breaks= scales::pretty_breaks())+ # 2020 geom_vline(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;, campana == &quot;20-21&quot;), aes(xintercept=rinde_med), col = &quot;red&quot;)+ # serie geom_vline(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Cebada&quot;), aes(xintercept=rinde_med), col = &quot;green&quot;)+ geom_text(data=filter(lotes_sum, cultivo_de_cosecha == &quot;Cebada&quot;), aes(x=rinde_med, y=-Inf, label=round(rinde_med,0)), vjust=-1,col = &quot;green&quot;)+ geom_text(data=filter(lotes, cultivo_de_cosecha == &quot;Cebada&quot;, campana == &quot;20-21&quot;), aes(x=rinde_med, y=Inf, label=round(rinde_med,0)), vjust=1.5,col = &quot;red&quot;)+ labs( caption = &quot;- Mediana 2017-2019: línea verde\\n- Mediana 2020-21: línea roja&quot;)+ theme_aapre) # ggsave(last_plot(), file = &quot;plots/rindes_20_serie_ceb.png&quot;, width = 4, height = 4) # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rindes_20_serie_ceb.png&quot;, overwrite = TRUE) 4.2 Brechas potencial &lt;- dat %&gt;% mutate_if(is.character, as.factor) %&gt;% filter(cultivo_de_cosecha %in% c(&quot;Trigo&quot;, &quot;Cebada&quot;)) %&gt;% filter(dano_tot &lt; 10, rinde &gt; 1000) %&gt;% # riego == &quot;NO&quot;) %&gt;% group_by(Zona, campana, cultivo_de_cosecha) %&gt;% summarise(.groups = &#39;drop&#39;, lotes = n(), rinde_50 = quantile(rinde, 0.5, na.rm = TRUE), rinde_90 = quantile(rinde, 0.90, na.rm = TRUE), rinde_95 = quantile(rinde, 0.95, na.rm = TRUE), dif = round((rinde_95-rinde_50)/rinde_95*100,1), label = paste(round(dif, 0), &quot;%&quot;, sep=&quot;&quot;), n_lotes = paste(&quot;(&quot;, round(lotes, 1), &quot;)&quot;, sep=&quot;&quot;)) %&gt;% complete(Zona, nesting(campana, cultivo_de_cosecha)) # potencial %&gt;% # write_sheet(ss=jmf, sheet = &quot;potencial&quot;) # potencial%&gt;% view ggplot(potencial) + facet_wrap(&quot;campana&quot;)+ geom_bar(aes(x=Zona, y=rinde_90, fill = cultivo_de_cosecha), position=position_dodge(width=0.9), stat=&quot;identity&quot;, alpha=0.5)+ geom_text(aes(Zona, rinde_90, fill = cultivo_de_cosecha, label=round(rinde_90,0)), stat=&quot;identity&quot;, position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3)+ geom_bar(aes(x=Zona, y=rinde_50, fill = cultivo_de_cosecha), position=position_dodge(width=0.9), stat=&quot;identity&quot;)+ geom_text(aes(Zona, rinde_50, fill = cultivo_de_cosecha, label=round(rinde_50,0)), position=position_dodge(width=0.9), vjust = 1, hjust=0.5, size = 3)+ labs(x = &quot;&quot;, y = &quot;kg/ha&quot;, title = &quot;Rendimientos 50° y 90°&quot;, fill = &quot;&quot;, caption = &quot;- Barras: 50° y 90° percentil\\n - Excuidos: daño por adversidades &gt; 10%, rinde &lt; 1000 kg/ha\\n - Numero de lotes entre paréntesis&quot; )+ scale_y_continuous(breaks= scales::pretty_breaks(), expand = c(0.2, 0))+ theme_bw2 # ggsave(last_plot(), file = &quot;plots/potencial_tr_ceb.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/potencial_tr_ceb.png&quot;, overwrite = TRUE) potencial %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% ggplot() + facet_wrap(&quot;campana&quot;)+ geom_bar(aes(x=Zona, y=rinde_95), # position=position_dodge(width=0.9), stat=&quot;identity&quot;, fill = alpha(&quot;#ff1212&quot;, 0.5))+ geom_text(aes(Zona, rinde_95, # fill = cultivo_de_cosecha, label=round(rinde_95,0)), stat=&quot;identity&quot;, # position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3)+ geom_bar(aes(x=Zona, y=rinde_50), # position=position_dodge(width=0.9), stat=&quot;identity&quot;, fill = alpha(&quot;#1212ff&quot;, 0.5) )+ geom_text(aes(Zona, rinde_50, # fill = cultivo_de_cosecha, label=round(rinde_50,0)), # position=position_dodge(width=0.9), vjust = 1, hjust=0.5, size = 3)+ geom_text(aes(Zona, y=((rinde_95-rinde_50)/2)+rinde_50, # fill = cultivo_de_cosecha, label=label), # position=position_dodge(width=0.9), vjust = 0, hjust=0.5, size = 3, fontface=&quot;bold&quot;)+ geom_text(aes(Zona, y=-Inf, # fill = cultivo_de_cosecha, label=n_lotes), # position=position_dodge(width=0.9), vjust = -2, hjust=0.5, size = 3, fontface=&quot;bold&quot;)+ labs(x = &quot;&quot;, y = &quot;kg/ha&quot;, title = &quot;Potencial de rendimiento - Trigo&quot;, # fill = &quot;&quot;, caption = &quot;- Barras: percentiles 95° (rosa) y 50° (violeta)\\n- Excluidos: daño por adversidades &gt; 10%, rinde &lt; 1000 kg/ha\\n- Numero de lotes entre paréntesis&quot; )+ theme_dens1 # ggsave(last_plot(), file = &quot;plots/potencial_trigo.png&quot;, w=5, h=6) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/potencial_trigo.png&quot;, overwrite = TRUE) "],["manejo.html", "5 Manejo", " 5 Manejo knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, lubridate, scales, ggridges) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) load(here::here(&quot;data/data.Rdata&quot;)) # glimpse(dat) Ventanas de siembra dat_fs &lt;- dat %&gt;% filter(fecha_de_siembra_dia_mes &gt; &#39;2015-01-01&#39;) %&gt;% mutate( year = factor(lubridate::year(as.Date(fecha_de_siembra_dia_mes))), date = update(as.Date(fecha_de_siembra_dia_mes), year = 1)) dat_fs %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% ggplot(aes(x = date, y = campana)) + geom_density_ridges(aes(fill = campana), panel_scaling = F, alpha =0.5, jittered_points = TRUE, scale = .5, rel_min_height = .01, point_shape = &quot;|&quot;, point_size = 1, size = 0.25, position = position_points_jitter(height = 0))+ guides(fill = &quot;none&quot;)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))+ facet_wrap(&quot;Zona&quot;)+ labs(x= &quot;&quot;, y = &quot;&quot;, title = &quot;Ventanas de siembra Trigo&quot; )+ theme_aapre ggsave(last_plot(), file = &quot;plots/ventanas_siembra_trigo.png&quot;, width = 6, height = 5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/ventanas_siembra_trigo.png&quot;, overwrite = TRUE) dat_fs %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% ggplot(aes(x = date, y = campana)) + geom_density_ridges(aes(fill = campana), panel_scaling = F, alpha =0.5, jittered_points = TRUE, scale = .5, rel_min_height = .01, point_shape = &quot;|&quot;, point_size = 1, size = 0.25, position = position_points_jitter(height = 0))+ # scale_x_date(date_labels = &quot;%^b&quot;, breaks = date_breaks(&quot;1 months&quot;), expand = c(0,0))+ guides(fill = &quot;none&quot;)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))+ facet_wrap(&quot;Zona&quot;)+ labs(x= &quot;&quot;, y = &quot;&quot;, title = &quot;Ventanas de siembra Cebada&quot; )+ theme_aapre ggsave(last_plot(), file = &quot;plots/ventanas_siembra_ceb.png&quot;, width = 6, height = 5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/ventanas_siembra_ceb.png&quot;, overwrite = TRUE) # dat %&gt;% # drop_na(rinde) %&gt;% # group_by(campana, Zona, cultivo_de_cosecha) %&gt;% # summarise(n_lotes = n(), # rinde_med = quantile(rinde, 0.5), # techo = quantile(rinde, 0.95)) -&gt; lotes # # unique(dat$variedad) # dat %&gt;% # filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% # count(cultivo_de_cosecha, variedad) %&gt;% # arrange(cultivo_de_cosecha, desc(n)) #%&gt;% # # write_sheet(ss=jmf, sheet = &quot;variedades&quot;) dat %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% ggplot(aes(date, rinde, color = Zona)) + facet_wrap(&quot;Zona&quot;)+ geom_point(alpha = 0.2)+ # geom_point(aes(color = year))+ theme_dens+ geom_smooth(se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 2)) + labs(x = &quot;Fecha de siembra&quot;, y = &quot;Rendimiento (kg/ha)&quot;, col =&quot;&quot;, title = &quot;Rinde Trigo 2017-2020&quot;) ggsave(last_plot(), file = &quot;plots/rinde_fs_trigo.png&quot;, width = 6, height = 5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rinde_fs_trigo.png&quot;, overwrite = TRUE) dat%&gt;% filter(date &lt;&#39;1-08-12&#39;) %&gt;% filter(cultivo_de_cosecha %in% c(&quot;Cebada&quot;)) %&gt;% filter(between(rinde, 2000,7500)) %&gt;% ggplot(aes(date, rinde, col = Zona))+#, col =variedad)) + facet_grid(.~Zona, scales=&quot;free_x&quot;)+ geom_point()+ theme_dens1+ geom_smooth(se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 2)) + guides(col = F)+ labs(x = &quot;Fecha de siembra&quot;, y = &quot;Rendimiento (kg/ha)&quot;, col =&quot;&quot;, title = &quot;Cebada&quot;) # geom_smooth(data = filter(dat_fs, Zona!=&quot;Madariaga&quot;), # se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 2)) + # # geom_smooth(data = filter(dat_fs, Zona!=&quot;Costa&quot;), # # se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 1)) + # labs(x = &quot;Fecha de siembra&quot;, y = &quot;Rendimiento (kg/ha)&quot;, # col =&quot;&quot;, # title = &quot;Rinde Cebada 2017-2020&quot;) ggsave(last_plot(), file = &quot;plots/rinde_fs_ceb.png&quot;, width = 6, height = 5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rinde_fs_ceb.png&quot;, overwrite = TRUE) dat %&gt;% drop_na(rinde) %&gt;% filter(date &gt; as.Date(&quot;0001-05-01&quot;) &amp; date &lt; as.Date(&quot;0001-08-15&quot;)) %&gt;% filter(between(rinde, 1000, 10000)) %&gt;% # mutate(zona = fct_rev(zona)) %&gt;% mutate(month = month(fecha_de_siembra_dia_mes, label = TRUE), day = day(fecha_de_siembra_dia_mes), quincena = case_when(day %in% 1:15 ~ &quot;Q1&quot;, TRUE ~ &quot;Q2&quot;), mes_q = factor(paste0(month, &quot;-&quot;, quincena))) %&gt;% mutate(mes_q = reorder(mes_q, as.integer(month), .fun = identity)) %&gt;% droplevels() -&gt; dat_quin # dat_quin dat_quin %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% ggplot(aes(x=mes_q, y=rinde))+ # geom_boxplot(fill = &quot;steelblue&quot;, outlier.size = 0, alpha=0.5) + geom_smooth(se = F, span = 0.8, col = &quot;red3&quot;, linetype = 2, aes(group=1))+ facet_grid(Zona~campana)+ geom_point(pch = 21, size=0.5)+ labs(x = &quot;Mes - Quincena&quot;, y = &quot;Rendimiento (kg/ha)&quot;, title = &quot;Trigo&quot;) + theme_dens1 ggsave(last_plot(), file = &quot;plots/rinde_fs_quincena_tr.png&quot;, w =6, h=5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rinde_fs_quincena_tr.png&quot;, overwrite = TRUE) dat_quin %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% ggplot(aes(x=mes_q, y=rinde))+ geom_smooth(se = F, span = 0.8, col = &quot;red3&quot;, linetype = 2, aes(group=1))+ facet_grid(Zona~campana)+ geom_point(pch = 21, size=0.5)+ labs(x = &quot;Mes - Quincena&quot;, y = &quot;Rendimiento (kg/ha)&quot;, title = &quot;Cebada&quot;) + theme_dens1 ggsave(last_plot(), file = &quot;plots/rinde_fs_quincena_ceb.png&quot;, w =6, h=5) drive_upload(path= as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/rinde_fs_quincena_ceb.png&quot;, overwrite = TRUE) (dat %&gt;% filter(variedad %in% c(&quot;BAGUETTE_802&quot;, &quot;BASILIO&quot;,&quot;BAGUETTE_501&quot;)) %&gt;% drop_na(fecha_de_siembra_dia_mes) %&gt;% select(Zona, fecha_de_siembra_dia_mes, variedad,rinde, campana) %&gt;% group_by(campana) %&gt;% #slice_sample(n = 3) %&gt;% mutate( year = factor(year(fecha_de_siembra_dia_mes)), date = update(fecha_de_siembra_dia_mes, year = 1), variedad = fct_relevel(variedad, &quot;BAGUETTE_802&quot;, &quot;BASILIO&quot;,&quot;BAGUETTE_501&quot;)) %&gt;% filter(!(date &gt; &#39;1-07-15&#39; &amp; variedad == &quot;BAGUETTE_802&quot;)) %&gt;% filter(rinde &lt; 10000) %&gt;% ggplot(aes(date, rinde)) + facet_grid(Zona ~variedad , scales=&quot;free_x&quot;)+ geom_point()+ # geom_point(aes(color = year))+ theme_dens1+ geom_smooth(se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 2)) + labs(x = &quot;Fecha de siembra&quot;, y = &quot;Rendimiento (kg/ha)&quot;, col =&quot;&quot;, title = &quot;Rinde trigo - ciclos (2017-2020)&quot;) ) ggsave(last_plot(), file = &quot;plots/ciclos_trigo.png&quot;, w=5, h=5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/ciclos_trigo.png&quot;, overwrite = TRUE) dat %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% filter(!str_detect(cultivo_de_cosecha, &#39;Candeal&#39;)) %&gt;% # filter(!antecesor_estival %in% c(&quot;OTRO&quot;, NA)) %&gt;% filter(!str_detect(antecesor_estival, &quot;SORGO|MAIZ_SEGUNDA|OTRO&quot;)) %&gt;% filter(rinde&gt;1000) %&gt;% drop_na(antecesor_estival) %&gt;% ggplot(aes(antecesor_estival, rinde)) + facet_grid(Zona~cultivo_de_cosecha, scales=&quot;free_x&quot;)+ geom_jitter(alpha=0.5, width = 0.1)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5, angle = 90)+ geom_smooth(se = F, method = &#39;lm&#39;, formula = y ~ poly(x, 2)) + labs(x = &quot;Fecha de siembra&quot;, y = &quot;Rendimiento (kg/ha)&quot;, col =&quot;&quot;, title = &quot;Rinde x antecesor (2017-2020)&quot;)+ theme_dens1 ggsave(last_plot(), file = &quot;plots/antecesores.png&quot;, w=5, h=5) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/antecesores.png&quot;, overwrite = TRUE) "],["variedades.html", "6 Variedades 6.1 Superficies (tamaño de cuadrados) y rendimientos (intensidad de color) 6.2 Performance variedades", " 6 Variedades knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse) # pacman::p_load(tidyverse, googlesheets4, googledrive) # javi &lt;- gs4_get(&quot;1jTFU8fQw2fiTyfrhuPSjc4lcAC6U9G-zjvOlADQ6JNE&quot;) # gs4_browse(javi) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) load(here::here(&quot;data/data.Rdata&quot;)) # glimpse(dat) dat %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% select(cultivo_de_cosecha, campana,Zona, variedad, rinde, superficie ) %&gt;% group_by(cultivo_de_cosecha, Zona, variedad) %&gt;% filter(n() &gt; 5) %&gt;% ungroup %&gt;% mutate_if(is.character, as.factor) %&gt;% group_by(cultivo_de_cosecha, Zona, campana, variedad) %&gt;% summarise(#var_lotes= n(), var_sup = sum(superficie, na.rm = TRUE), rinde_medio = median(rinde, na.rm = TRUE), .groups = &#39;drop&#39;) %&gt;% group_by(cultivo_de_cosecha, Zona, campana) %&gt;% mutate(porcent=var_sup/sum(var_sup)*100) -&gt; dat_var dat_var ## # A tibble: 82 x 7 ## # Groups: cultivo_de_cosecha, Zona, campana [26] ## cultivo_de_cosecha Zona campana variedad var_sup rinde_medio porcent ## &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Cebada Costa 17-18 ANDREIA 500 5400 86.2 ## 2 Cebada Costa 17-18 SHAKIRA 80 6100 13.8 ## 3 Cebada Costa 18-19 ANDREIA 2014 5500 88.8 ## 4 Cebada Costa 18-19 SHAKIRA 253 3920. 11.2 ## 5 Cebada Costa 19-20 ANDREIA 860 5700 75.0 ## 6 Cebada Costa 19-20 SHAKIRA 287 5536 25.0 ## 7 Cebada Costa 20-21 ANDREIA 319 6225 100 ## 8 Cebada Madariaga 18-19 ANDREIA 488. 4790. 88.1 ## 9 Cebada Madariaga 18-19 OVERTURE 66 5665 11.9 ## 10 Cebada Madariaga 19-20 ANDREIA 118. 6024 60.6 ## # … with 72 more rows dat_var %&gt;% #data.frame filter(cultivo_de_cosecha ==&quot;Cebada&quot;) %&gt;% ggplot(aes(x =factor(1), y = porcent, fill = variedad)) + geom_bar(stat=&#39;identity&#39;) + coord_polar(theta = &quot;y&quot;)+ facet_grid(Zona ~ campana, switch = &quot;y&quot;)+ theme_void()+ geom_text(aes(label=paste0(round(porcent))), position=position_stack(vjust=0.5), color=&quot;white&quot;,size=3, fontface =&quot;bold&quot;)+ theme(legend.position=&quot;bottom&quot;)+ scale_fill_viridis_d(begin = 0, end =0.8, direction = -1) # ggsave(last_plot(), file = &quot;plots/sup_var_zona_ceb.png&quot;, width = 7, height = 4) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/sup_var_zona_ceb.png&quot;, overwrite = TRUE) dat_var %&gt;% #data.frame filter(cultivo_de_cosecha ==&quot;Trigo&quot;) %&gt;% ggplot(aes(x =factor(1), y = porcent, fill = variedad)) + geom_bar(stat=&#39;identity&#39;) + coord_polar(theta = &quot;y&quot;)+ facet_grid(Zona ~ campana, switch = &quot;y&quot;)+ theme_void()+ geom_text(aes(label=paste0(round(porcent))), position=position_stack(vjust=0.5), color=&quot;white&quot;,size=3, fontface =&quot;bold&quot;)+ theme(legend.position=&quot;bottom&quot;)+ scale_fill_hue() # ggsave(last_plot(), file = &quot;plots/sup_var_zona_tr1.png&quot;, width = 7, height = 4) dat_var %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% # filter(variedad == &quot;Andreia&quot;) # drop_na(rinde) %&gt;% ggplot(aes(x = factor(campana), y = porcent, col = variedad, group =variedad))+ geom_line()+geom_point()+ facet_grid(Zona~.)+ labs(x = NULL, y = &quot;% del área de cada zona&quot;, col=&quot;&quot;, title = &quot;Evolucion de superficie de trigo&quot;)+ # guides(col=&quot;none&quot;)+ ggrepel::geom_text_repel( data = dat_var %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(campana == &quot;19-20&quot;), # drop_na(tecno_sts), aes(label = variedad), size =3, nudge_x = 0.1) + theme_dens1 # ggsave(last_plot(), file = &quot;plots/evolucion_trigo.png&quot;, w =7, h=4) 6.1 Superficies (tamaño de cuadrados) y rendimientos (intensidad de color) library(treemap) dat_sum &lt;- dat %&gt;% # filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% # filter(campana == &quot;19-20&quot;) %&gt;% # group_by(variedad) %&gt;% # filter(n()&gt;10) %&gt;% ungroup %&gt;% group_by(campana, cultivo_de_cosecha, variedad) %&gt;% summarise(lotes= n(), sup = sum(superficie, na.rm = TRUE), rinde_medio = median(rinde, na.rm = TRUE), .groups = &#39;drop&#39;) %&gt;% mutate_if(is.character, as.factor)%&gt;% mutate(label = paste(variedad, round(sup,0), sep = &quot;\\n&quot;)) # png(filename=&quot;plots/treemap_trigo_17-18.png&quot;, # width = 120, height = 120, units=&#39;mm&#39;, res = 300) subset(dat_sum, cultivo_de_cosecha == &quot;Trigo&quot; &amp; campana == &#39;17-18&#39;) %&gt;% treemap(index=&quot;label&quot;, vSize=&quot;sup&quot;, vColor=&quot;rinde_medio&quot;, # border.col=c(&quot;grey70&quot;, &quot;grey90&quot;), # palette=&quot;Spectral&quot;, type = &quot;value&quot;, title = &quot;Superficie de trigo (has) - 2017/18&quot;, title.legend = &quot;Rendimiento medio (qq/ha)&quot;, overlap.labels=1, bg.labels=c(&quot;transparent&quot;), inflate.labels=F, align.labels=c(&quot;center&quot;, &quot;center&quot;)) # dev.off() # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/treemap_trigo_17-18.png&quot;, overwrite = TRUE) evol_trigo &lt;- list.files(path = here::here(&quot;plots&quot;), pattern = &quot;treemap_&quot;, all.files = TRUE, full.names = TRUE) evol_trigo %&gt;% map(~ drive_upload(., path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), overwrite = TRUE) ) # png(filename=&quot;plots/treemap_cebada.png&quot;, # width = 120, height = 120, units=&#39;mm&#39;, res = 300) subset(dat_sum, cultivo_de_cosecha == &quot;Cebada&quot; ) %&gt;% treemap(index=c(&quot;campana&quot;, &quot;label&quot;), vSize=&quot;sup&quot;, vColor=&quot;rinde_medio&quot;, # border.col=c(&quot;grey70&quot;, &quot;grey90&quot;), # palette=&quot;Spectral&quot;, type = &quot;value&quot;, title = &quot;Superficie de cebada (has)&quot;, title.legend = &quot;Rendimiento medio (qq/ha)&quot;, overlap.labels=1, bg.labels=c(&quot;transparent&quot;), # Background color of labels inflate.labels=F, align.labels=list( c(&quot;left&quot;, &quot;top&quot;), c(&quot;center&quot;, &quot;center&quot;))) # dev.off() # # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/treemap_cebada.png&quot;, overwrite = TRUE) 6.2 Performance variedades dat %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% select(campana,Zona, cultivo_de_cosecha, variedad,rinde ) %&gt;% group_by(cultivo_de_cosecha, Zona, variedad) %&gt;% filter(n() &gt; 3) %&gt;% ungroup %&gt;% mutate_if(is.character, as.factor) -&gt;dat1 dat1 %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr&#39;)) %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% distinct(variedad) %&gt;% pull() %&gt;% droplevels()-&gt; var_20_tr trigo_zona = levels(dat1$Zona) %&gt;% map(~ subset(dat1, cultivo_de_cosecha== &quot;Trigo&quot; &amp; variedad %in% var_20_tr &amp; Zona == . ) %&gt;% ggplot()+ aes(x=reorder(variedad, rinde, mean), y=rinde)+ geom_point(alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ coord_flip()+ theme_bw2+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ scale_y_continuous(breaks= scales::pretty_breaks())+ labs(title = paste0(.), x=&quot;&quot;, y=&quot;kg/ha&quot;) ) trigo_zona ## [[1]] ## ## [[2]] ## ## [[3]] # trigo_zona[[1]] %&gt;% # ggsave(file = &quot;plots/trigo_perf_Costa.png&quot;, w=5, h=5) # trigo_zona[[2]] %&gt;% # ggsave(file = &quot;plots/trigo_perf_Madariaga.png&quot;, w=5, h=5) # trigo_zona[[3]] %&gt;% # ggsave(file = &quot;plots/trigo_perf_Sierra.png&quot;, w=5, h=5) list.files(path = here::here(&quot;plots&quot;), pattern = &quot;perf&quot;, all.files = TRUE, full.names = TRUE) %&gt;% map(~ drive_upload(., path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), overwrite = TRUE)) dat1 %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Ceb&#39;)) %&gt;% ggplot()+ aes(x=reorder(variedad, rinde, mean), y=rinde)+ facet_wrap(Zona~., scales=&quot;free_x&quot;)+ geom_point(alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ # coord_flip()+ theme_aapre+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ scale_y_continuous(breaks= scales::pretty_breaks())+ labs(title = &quot;Cebada&quot;, x=&quot;&quot;, y=&quot;kg/ha&quot;) last_plot() %&gt;% ggsave(file = &quot;plots/cebada_perf.png&quot;, w=5, h=4) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/plots&quot;), &quot;plots/cebada_perf.png&quot;, overwrite = TRUE) "],["protección.html", "7 Protección", " 7 Protección knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, googlesheets4, googledrive) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) load(here::here(&quot;data/data.Rdata&quot;)) # glimpse(dat) fungicidas = &quot;https://docs.google.com/spreadsheets/d/1cTzo36jHRULfBf8c83TDpauxiwHrxeKrGprUUxLRzm0/edit?usp=sharing&quot; fungic &lt;- gs4_get(fungicidas) dfungi &lt;- read_sheet(fungic, sheet = &quot;fungi&quot;) dfungi &lt;- dfungi %&gt;% distinct(producto, .keep_all = TRUE) %&gt;% arrange(producto) head(dfungi) ## # A tibble: 6 x 18 ## Cultivo Empresa producto dosis activos grupos DMI_1 DMI_2 QoI_1 SDHI_1 SDHI_2 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 Cebada BASF ALLEGRO 0.75 2 TE Epox… &lt;NA&gt; kres… &lt;NA&gt; &lt;NA&gt; ## 2 Cebada Adama ALMAGOR 1.25 3 TTE Tebu… Proc… Azox… &lt;NA&gt; &lt;NA&gt; ## 3 Cebada Syngenta AMISTAR… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 4 Trigo Genérico AZOXY_P… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 5 Cebada Zamba CINCHA_… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 6 Cebada Bayer CRIPTON 0.6 2 TE Prot… &lt;NA&gt; Trif… &lt;NA&gt; &lt;NA&gt; ## # … with 7 more variables: contacto &lt;chr&gt;, c.DMI1 &lt;dbl&gt;, c.DMI2 &lt;dbl&gt;, ## # c.QoI &lt;dbl&gt;, c.SDHI1 &lt;dbl&gt;, c.SDHI2 &lt;dbl&gt;, c.contacto &lt;dbl&gt; dat %&gt;% select(cultivo_de_cosecha, campana, Zona, contains(&quot;fungicida&quot;)) %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% filter(!str_detect(cultivo_de_cosecha, &#39;Candeal&#39;)) %&gt;% rowwise() %&gt;% mutate(aplicaciones = sum(!is.na(fungicida1), !is.na(fungicida2))) %&gt;% ungroup() %&gt;% count(cultivo_de_cosecha, Zona, campana, aplicaciones) %&gt;% arrange(cultivo_de_cosecha, Zona,campana, aplicaciones, -n) %&gt;% group_by(cultivo_de_cosecha, Zona, campana) %&gt;% mutate(porcent = round((n/sum(n))*100)) -&gt; dat_fungi head(dat_fungi) ## # A tibble: 6 x 6 ## # Groups: cultivo_de_cosecha, Zona, campana [4] ## cultivo_de_cosecha Zona campana aplicaciones n porcent ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Cebada Costa 17-18 0 15 100 ## 2 Cebada Costa 18-19 1 9 22 ## 3 Cebada Costa 18-19 2 31 78 ## 4 Cebada Costa 19-20 1 6 32 ## 5 Cebada Costa 19-20 2 13 68 ## 6 Cebada Costa 20-21 1 7 64 Cuantas aplicaciones se llevan los cultivos? dat_fungi %&gt;% filter(!campana == &quot;17-18&quot;) %&gt;% group_by(cultivo_de_cosecha, Zona, campana)%&gt;% summarise(media = weighted.mean(aplicaciones, n)) -&gt; n_fungi head(n_fungi) ## # A tibble: 6 x 4 ## # Groups: cultivo_de_cosecha, Zona [2] ## cultivo_de_cosecha Zona campana media ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Cebada Costa 18-19 1.78 ## 2 Cebada Costa 19-20 1.68 ## 3 Cebada Costa 20-21 1.36 ## 4 Cebada Madariaga 18-19 1.69 ## 5 Cebada Madariaga 19-20 1.29 ## 6 Cebada Madariaga 20-21 1.56 dat_fungi %&gt;% mutate(aplicaciones = fct_relevel(as.factor(aplicaciones), c(&#39;0&#39;,&#39;1&#39;,&#39;2&#39;))) %&gt;% filter(!campana ==&quot;17-18&quot;) %&gt;% filter(cultivo_de_cosecha ==&quot;Trigo&quot;) %&gt;% ggplot(aes(x = Zona, y = porcent, fill =forcats::fct_rev(aplicaciones), label = round(porcent))) + facet_grid(. ~ campana)+ geom_col(position = position_stack(), color = &quot;black&quot;, alpha= 0.5) + geom_text(position = position_stack(vjust = .5), fontface = &quot;bold&quot;, size=3) + labs(title = &quot;Trigo&quot; , fill = &quot;Nro de aplicaciones&quot;, x = &quot;&quot;, y = &quot;% lotes aplicados&quot;)+ geom_text(data = n_fungi %&gt;% filter(cultivo_de_cosecha ==&quot;Trigo&quot;), aes(x= Zona, y=-10, label = round(media,1), fill = NA), angle = 0) + scale_y_continuous(expand = expand_scale(add = c(13,3)))+ theme(axis.text.x=element_blank())+ coord_flip()+ scale_fill_manual(values = c(&quot;0&quot;= &quot;green3&quot;, &quot;1&quot;=&quot;steelblue&quot;, &quot;2&quot; =&quot;red3&quot;))+ theme_dens1_legend # ggsave(last_plot(), file = &quot;5_plots_fungi/fungicidas_aplicaciones_trigo.png&quot;, width = 7, height = 3) dat_fungi %&gt;% mutate(aplicaciones = fct_relevel(as.factor(aplicaciones), c(&#39;0&#39;,&#39;1&#39;,&#39;2&#39;))) %&gt;% filter(!campana ==&quot;17-18&quot;) %&gt;% filter(cultivo_de_cosecha ==&quot;Cebada&quot;) %&gt;% ggplot(aes(x = Zona, y = porcent, fill =forcats::fct_rev(aplicaciones), label = round(porcent))) + facet_grid(. ~ campana)+ geom_col(position = position_stack(), color = &quot;black&quot;, alpha= 0.5) + geom_text(position = position_stack(vjust = .5), fontface = &quot;bold&quot;, size=3) + labs(title = &quot;Cebada&quot; , fill = &quot;Nro de aplicaciones&quot;, x = &quot;&quot;, y = &quot;% lotes aplicados&quot;)+ geom_text(data = n_fungi %&gt;% filter(cultivo_de_cosecha ==&quot;Trigo&quot;), aes(x= Zona, y=-10, label = round(media,1), fill = NA), angle = 0) + scale_y_continuous(expand = expand_scale(add = c(13,3)))+ theme(axis.text.x=element_blank())+ coord_flip()+ scale_fill_manual(values = c(&quot;0&quot;= &quot;green3&quot;, &quot;1&quot;=&quot;steelblue&quot;, &quot;2&quot; =&quot;red3&quot;))+ theme_dens1_legend # ggsave(last_plot(), file = &quot;5_plots_fungi/fungicidas_aplicaciones_cebada.png&quot;, width = 7, # height = 3) Lotes aplicados en 2020 dat %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% filter(fungicida == &quot;Si&quot;) %&gt;% filter(str_detect(cultivo_de_cosecha, &#39;Tr|Ceb&#39;)) %&gt;% filter(!str_detect(cultivo_de_cosecha, &#39;Candeal&#39;)) %&gt;% select(cultivo_de_cosecha, Zona, campo, variedad, fungicida:enfermedad_2, rinde) %&gt;% rowwise() %&gt;% mutate(aplicaciones = sum(!is.na(fungicida1),!is.na(fungicida2), na.rm = T)) -&gt; df20 head(df20) ## # A tibble: 6 x 13 ## # Rowwise: ## cultivo_de_cosecha Zona campo variedad fungicida fungicida1 feno_fungi1 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;list&gt; ## 1 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## 2 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## 3 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## 4 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## 5 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## 6 Trigo Costa La Susa… BAGUETTE_8… Si ELATUS_ACE &lt;chr [1]&gt; ## # … with 6 more variables: enfermedad_1 &lt;chr&gt;, fungicida2 &lt;chr&gt;, ## # feno_fungi2 &lt;chr&gt;, enfermedad_2 &lt;chr&gt;, rinde &lt;dbl&gt;, aplicaciones &lt;int&gt; Los que aplican 1 solo fungi: en que estadio lo hacen? require(webr) dfungi %&gt;% mutate(across(contains(&quot;.c&quot;), ~.*dosis)) ## # A tibble: 35 x 18 ## Cultivo Empresa producto dosis activos grupos DMI_1 DMI_2 QoI_1 SDHI_1 SDHI_2 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 Cebada BASF ALLEGRO 0.75 2 TE Epox… &lt;NA&gt; kres… &lt;NA&gt; &lt;NA&gt; ## 2 Cebada Adama ALMAGOR 1.25 3 TTE Tebu… Proc… Azox… &lt;NA&gt; &lt;NA&gt; ## 3 Cebada Syngen… AMISTAR… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 4 Trigo Genéri… AZOXY_P… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 5 Cebada Zamba CINCHA_… 0.4 2 TE Cypr… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 6 Cebada Bayer CRIPTON 0.6 2 TE Prot… &lt;NA&gt; Trif… &lt;NA&gt; &lt;NA&gt; ## 7 Cebada Bayer CRIPTON… 0.6 3 TEC Prot… &lt;NA&gt; Trif… Bixaf… &lt;NA&gt; ## 8 Trigo Adama CUSTODIA 0.7 2 TE Tebu… &lt;NA&gt; Azox… &lt;NA&gt; &lt;NA&gt; ## 9 Trigo Syngen… DACONIL 2 1 O &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; ## 10 Cebada BASF DUETT_P… 1.2 2 TT Epox… Metc… &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; ## # … with 25 more rows, and 7 more variables: contacto &lt;chr&gt;, c.DMI1 &lt;dbl&gt;, ## # c.DMI2 &lt;dbl&gt;, c.QoI &lt;dbl&gt;, c.SDHI1 &lt;dbl&gt;, c.SDHI2 &lt;dbl&gt;, c.contacto &lt;dbl&gt; df20 %&gt;% count(cultivo_de_cosecha, aplicaciones, producto= fungicida1) %&gt;% arrange(-n) %&gt;% left_join(select(dfungi, producto, activos, grupos), by = &quot;producto&quot;) %&gt;% drop_na(producto) %&gt;% mutate(mezcla = case_when( activos == 2 ~ &quot;Doble&quot;, activos == 3 ~ &quot;Triple&quot;), mezcla = fct_rev(mezcla)) -&gt; df20_fungi1 head(df20_fungi1) ## # A tibble: 6 x 7 ## cultivo_de_cosecha aplicaciones producto n activos grupos mezcla ## &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt; ## 1 Trigo 1 MIRAVIS_TRIPLE 37 3 TCC Triple ## 2 Trigo 2 CRIPTON 22 2 TE Doble ## 3 Cebada 1 MIRAVIS_TRIPLE 15 3 TCC Triple ## 4 Trigo 2 AMISTAR_XTRA 15 2 TE Doble ## 5 Trigo 1 ORQUESTA_ULTRA 12 3 TEC Triple ## 6 Trigo 1 TRIDIUM 12 3 TEO Triple df20_fungi1 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(aplicaciones ==1) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n)) # ggsave(file = &quot;plots_fungi/aplic_simple_tr.png&quot;, width = 6, height = 6) df20_fungi1 %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% filter(aplicaciones ==1) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n)) # ggsave(file = &quot;5_plots_fungi/aplic_simple_ceb.png&quot;, width = 6, height = 6) df20_fungi1 %&gt;% filter(aplicaciones ==2) %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n), labelposition=1, r0=0.2,r1=0.8,r2=1.4) # ggsave(file = &quot;5_plots_fungi/aplic_simple_ceb.png&quot;, width = 6, height = 6) df20_fungi1 %&gt;% filter(aplicaciones ==2) %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n), labelposition=0, r0=0.2,r1=0.8,r2=1.4) df20 %&gt;% filter(aplicaciones ==2) %&gt;% count(cultivo_de_cosecha, producto= fungicida2) %&gt;% arrange(-n) %&gt;% left_join(select(dfungi, producto, activos, grupos), by = &quot;producto&quot;) %&gt;% drop_na(producto) %&gt;% mutate(mezcla = case_when( activos == 2 ~ &quot;Doble&quot;, activos == 3 ~ &quot;Triple&quot;), mezcla = fct_rev(mezcla)) -&gt; df20_fungi2 df20_fungi2 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n), labelposition=0, r0=0.2,r1=0.8,r2=1.4) df20_fungi2 %&gt;% filter(cultivo_de_cosecha == &quot;Cebada&quot;) %&gt;% PieDonut(aes(pies=mezcla, donuts=producto, count =n), labelposition=0, r0=0.2,r1=0.8,r2=1.4) list.files(path = here::here(&quot;fungi_plots&quot;), pattern = &quot;.png&quot;, all.files = TRUE, full.names = TRUE) %&gt;% map(~ drive_upload(., path = as_dribble(&quot;juanchi_guille/JMF_fina_2020/5_plots_fungi&quot;), overwrite = TRUE)) ## list() df20 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% # filter(aplicaciones == 1) %&gt;% drop_na(enfermedad_1) %&gt;% rename(producto = fungicida1) %&gt;% left_join(select(dfungi, producto, activos, grupos), by = &quot;producto&quot;) %&gt;% drop_na(producto) %&gt;% mutate(mezcla = case_when( activos == 2 ~ &quot;Doble&quot;, activos == 3 ~ &quot;Triple&quot;), mezcla = mezcla) %&gt;% ggplot()+ facet_grid(enfermedad_1 ~ Zona, scales = &quot;free_y&quot;)+ aes(x = factor(aplicaciones), y=rinde)+ geom_point(alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ labs(x = &quot;Nro de aplicaciones&quot;, y = &quot;kg/ha&quot;, title = &quot;Trigo/2020&quot;)+ theme_bw2 df20 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% filter(aplicaciones == 1) %&gt;% drop_na(enfermedad_1) %&gt;% rename(producto = fungicida1) %&gt;% left_join(select(dfungi, producto, activos, grupos), by = &quot;producto&quot;) %&gt;% drop_na(producto) %&gt;% mutate(mezcla = case_when( activos == 2 ~ &quot;Doble&quot;, activos == 3 ~ &quot;Triple&quot;), mezcla = mezcla) %&gt;% ggplot()+ facet_grid(enfermedad_1 ~ Zona, scales = &quot;free_y&quot;)+ aes(x = factor(mezcla), y=rinde)+ geom_point(alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ labs(x = &quot;Tipo de mezcla&quot;, y = &quot;kg/ha&quot;, title = &quot;Trigo/2020 - aplicación simple&quot;)+ theme_bw2 df20 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% # filter(aplicaciones == 1) %&gt;% filter(Zona == &quot;Madariaga&quot;) %&gt;% # count(campo) %&gt;% arrange(-n) filter(campo == &quot;Bellamar&quot;) %&gt;% drop_na(enfermedad_1) %&gt;% rename(producto = fungicida1) %&gt;% left_join(select(dfungi, producto, activos, grupos), by = &quot;producto&quot;) %&gt;% # count(producto) %&gt;% arrange(-n) drop_na(producto) %&gt;% mutate(mezcla = case_when( activos == 2 ~ &quot;Doble&quot;, activos == 3 ~ &quot;Triple&quot;), mezcla = mezcla) %&gt;% ggplot()+ # facet_grid(. ~ enfermedad_1, scales = &quot;free_y&quot;)+ aes(x = producto, y=rinde)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ geom_point(alpha=0.3)+ labs(x = &quot;Tipo de mezcla&quot;, y = &quot;kg/ha&quot;, title = &quot;Trigo/2020 - aplicación simple&quot;)+ coord_flip()+ theme_bw2 df20 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% drop_na(enfermedad_1) %&gt;% # distinct(enfermedad_1) %&gt;% pull ggplot()+ aes(x = factor(aplicaciones), y=rinde)+ geom_point(alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ facet_grid(enfermedad_1 ~ Zona, scales = &quot;free_y&quot;)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4,vjust = -0.5)+ labs(x = &quot;Nro de aplicaciones&quot;, y = &quot;kg/ha&quot;, title = &quot;Trigo/2020 - Enfermedad_1 &quot;)+ theme_bw2 n_fun &lt;- function(x){ return(data.frame(y = -Inf, label = paste0(&quot;n = &quot;,length(x)))) } df20 %&gt;% filter(cultivo_de_cosecha == &quot;Trigo&quot;) %&gt;% # count(variedad) %&gt;% arrange(-n) filter(str_detect(variedad, &quot;BAGUETTE&quot;)) %&gt;% drop_na(enfermedad_1) %&gt;% ggplot()+ aes(x = factor(aplicaciones), y=rinde)+ geom_point(aes(col=variedad), alpha=0.3)+ stat_summary(fun.data = &quot;mean_cl_boot&quot;, colour = &quot;red&quot;, size = 0.5)+ facet_grid(. ~ enfermedad_1, scales = &quot;free_y&quot;)+ stat_summary(aes(label=round(..y..,0)), fun=mean, geom=&quot;text&quot;, size=4, vjust = -0.5)+ stat_summary(fun.data = n_fun, geom = &quot;text&quot;, vjust = -0.5)+ labs(x = &quot;Nro de aplicaciones&quot;, y = &quot;kg/ha&quot;, title = &quot;Trigo/2020 - Enfermedad_1 &quot;)+ theme_bw2 "],["malezas.html", "8 Malezas", " 8 Malezas knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, fuzzyjoin) load(here::here(&quot;data/data.Rdata&quot;)) source(here::here(&quot;0 themes.R&quot;)) dat %&gt;% select(campana, Zona, cultivo_de_cosecha, superficie, starts_with(&quot;especie&quot;)) %&gt;% mutate(across(starts_with(&quot;especie&quot;), ~stringi::stri_trans_general(., &quot;Latin-ASCII&quot;))) %&gt;% #sacar acentos mutate(across(starts_with(&quot;especie&quot;), ~str_to_upper(gsub(&#39;,&#39;, &#39;\\\\.&#39;,.)))) %&gt;% # UPPER + sacar &quot;,&quot; mutate(across(starts_with(&quot;especie&quot;), ~str_replace(., &quot;SP.&quot;, &quot;&quot;))) %&gt;% # sacar SP. mutate(across(starts_with(&quot;especie&quot;), ~str_trim(.))) -&gt; adv_herb #sacar espacios antes-desp adv_herb %&gt;% filter_at(vars(starts_with(&quot;especie&quot;)), any_vars(!is.na(.))) %&gt;% pivot_longer(-(campana:superficie), names_to = &quot;nivel&quot;, values_to = &quot;maleza&quot;)%&gt;% filter(!maleza %in% c(NA, &quot;OTRO&quot;, &quot;OTRA&quot;, &quot;VARIAS&quot;, &quot;ROSETA&quot;))%&gt;% count(maleza) ## # A tibble: 14 x 2 ## maleza n ## &lt;chr&gt; &lt;int&gt; ## 1 AVENA NEGRA 47 ## 2 CAPIQUI 4 ## 3 CARDOS 4 ## 4 CRUCIFERAS 266 ## 5 PAPA 3 ## 6 PEREJILILLO 1 ## 7 POA 1 ## 8 RAIGRAS 224 ## 9 RAIGRASS 1 ## 10 RAMA NEGRA 61 ## 11 SANGUINARIA 15 ## 12 SONCHUS 53 ## 13 TRIGO 2 ## 14 VIOLA 4 malezas_ref &lt;- gsheet::gsheet2tbl(&quot;https://docs.google.com/spreadsheets/d/1cTzo36jHRULfBf8c83TDpauxiwHrxeKrGprUUxLRzm0/edit#gid=1182890772&quot;) malezas_ref %&gt;% print(n=Inf) ## # A tibble: 33 x 4 ## genero sp n_comun n_grupo ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 ALTAMISA &lt;NA&gt; ALTAMISA &lt;NA&gt; ## 2 &lt;NA&gt; &lt;NA&gt; AVENA NEGRA GRAMINEA ## 3 IPOMOEA PURPUREA BEJUCO &lt;NA&gt; ## 4 BORRERIA DENSIFLORA BORRERIA &lt;NA&gt; ## 5 ECHINOCLOA CRUSGALLI CAPIN &lt;NA&gt; ## 6 CIRSIUM VULGARE CARDO &lt;NA&gt; ## 7 BROMUS &lt;NA&gt; CEBADILLA GRAMINEA ## 8 CYPERUS ROTUNDUS CEBOLLIN &lt;NA&gt; ## 9 SONCHUS OLERACEUS CERRAJA &lt;NA&gt; ## 10 CHLORIS &lt;NA&gt; CHLORIS GRAMINEA ## 11 COMMELINA &lt;NA&gt; COMMELINA &lt;NA&gt; ## 12 PAPPOPHORUM &lt;NA&gt; CORTADERA &lt;NA&gt; ## 13 &lt;NA&gt; &lt;NA&gt; CRUCIFERA &lt;NA&gt; ## 14 DIGITARIA &lt;NA&gt; DIGITARIA &lt;NA&gt; ## 15 ELEUSINE &lt;NA&gt; ELEUSINE &lt;NA&gt; ## 16 EUPHORBIA &lt;NA&gt; EUPHORBIA &lt;NA&gt; ## 17 GNAPHALIUM &lt;NA&gt; GNAPHALIUM &lt;NA&gt; ## 18 GOMPHRENA &lt;NA&gt; GOMPHRENA &lt;NA&gt; ## 19 CYNODON DACTYLON GRAMON GRAMINEA ## 20 LAMIUN &lt;NA&gt; LAMIUN &lt;NA&gt; ## 21 ZEA MAIZ &lt;NA&gt; MAIZ RR &lt;NA&gt; ## 22 &lt;NA&gt; &lt;NA&gt; MANI GUACHO &lt;NA&gt; ## 23 BASSIA &lt;NA&gt; MORENITA &lt;NA&gt; ## 24 PARIETARIA DEBILIS OCUCHA &lt;NA&gt; ## 25 &lt;NA&gt; &lt;NA&gt; RAIGRAS GRAMINEA ## 26 CONYZA &lt;NA&gt; RAMA NEGRA &lt;NA&gt; ## 27 &lt;NA&gt; &lt;NA&gt; SANGUINARIA &lt;NA&gt; ## 28 SENECIO PAMPEANUS SENECIO &lt;NA&gt; ## 29 &lt;NA&gt; &lt;NA&gt; SONCHUS &lt;NA&gt; ## 30 SORGHUM HALEPENSE SORGO DE ALEPO GRAMINEA ## 31 TRICHLORIS &lt;NA&gt; TRICHLORIS &lt;NA&gt; ## 32 VIOLA ARVENSIS VIOLA &lt;NA&gt; ## 33 AMARANTHUS QUITENSIS YUYO COLORADO &lt;NA&gt; # browseURL(&quot;https://docs.google.com/spreadsheets/d/1YL6vwgVu1nyMuZLRZw5uMav7cMt2mDXd7mI2S8Q6Q7c/edit#gid=950522321&quot;) herb_long &lt;- adv_herb %&gt;% #count(especie_principal) filter_at(vars(starts_with(&quot;especie&quot;)), any_vars(!is.na(.))) %&gt;% pivot_longer(-(campana:superficie), names_to = &quot;nivel&quot;, values_to = &quot;maleza&quot;)%&gt;% filter(!maleza %in% c(NA, &quot;OTRO&quot;, &quot;OTRA&quot;, &quot;VARIAS&quot;, &quot;ROSETA&quot;)) %&gt;% stringdist_left_join(malezas_ref %&gt;% drop_na(genero), by = c(maleza = &quot;genero&quot;), max_dist = 1) %&gt;% stringdist_left_join(malezas_ref %&gt;% drop_na(n_comun), by = c(maleza = &quot;n_comun&quot;), max_dist = 1) %&gt;% mutate(maleza = coalesce(n_comun.x,n_comun.y )) %&gt;% select(campana:nivel, maleza)%&gt;% group_by(campana, Zona, nivel, maleza)%&gt;% summarise(var_sup = sum(superficie, na.rm = TRUE))%&gt;% group_by(campana, Zona, nivel) %&gt;% mutate(Zona= as.factor(Zona), porcent=var_sup/sum(var_sup)*100, nivel = recode(nivel, especie_principal = &quot;1° Especie&quot;, especie_secundaria = &quot;2° Especie&quot;, especie_terciaria= &quot;3° Especie&quot;)) %&gt;% drop_na(maleza) herb_long ## # A tibble: 98 x 6 ## # Groups: campana, Zona, nivel [26] ## campana Zona nivel maleza var_sup porcent ## &lt;chr&gt; &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 18-19 Costa 1° Especie AVENA NEGRA 419 11.9 ## 2 18-19 Costa 1° Especie CERRAJA 415 11.8 ## 3 18-19 Costa 1° Especie CRUCIFERA 1967 55.8 ## 4 18-19 Costa 1° Especie RAIGRAS 655 18.6 ## 5 18-19 Costa 1° Especie RAMA NEGRA 38 1.08 ## 6 18-19 Costa 1° Especie SANGUINARIA 30 0.851 ## 7 18-19 Costa 2° Especie AVENA NEGRA 299 7.41 ## 8 18-19 Costa 2° Especie CERRAJA 661 16.4 ## 9 18-19 Costa 2° Especie CRUCIFERA 1353 33.5 ## 10 18-19 Costa 2° Especie RAIGRAS 1142 28.3 ## # … with 88 more rows # herb_long %&gt;% write_sheet(ss=jmf, sheet = &quot;malezas&quot;) plots_herb &lt;- herb_long %&gt;% filter(!nivel == &quot;3° Especie&quot;)%&gt;% group_by(Zona) %&gt;% nest() %&gt;% mutate(plot = map2(data, Zona, ~ggplot(data = .x, aes(x = factor(campana), y = porcent, col = maleza, group = maleza))+ geom_line()+ geom_point()+ labs(x = NULL, y = &quot;% del área de cada zona&quot;, title = paste0(&quot;Evolución de principales malezas - Zona &quot;, .y))+ guides(col=&quot;none&quot;)+ facet_wrap(~nivel)+ ggrepel::geom_text_repel( data = .x %&gt;% filter(Zona == .y, campana == &quot;20-21&quot;), aes(label = maleza), size =4, nudge_x = 0.2) + ggrepel::geom_text_repel( data = .x %&gt;% filter(Zona == .y, campana == &quot;18-19&quot;), aes(label = maleza), size =4, nudge_x = 0.2) + theme_bw2 )) plots_herb$plot ## [[1]] ## ## [[2]] ## ## [[3]] # file_names &lt;- paste0(&quot;adversidades/&quot;, levels(herb_long$Zona), &quot;_malezas.png&quot;) # map2(file_names, plots_herb$plot, ggsave) "]]
