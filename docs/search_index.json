[["02-superficies.html", "2 Zonas de análisis 3 Superficies 3.1 Superficie por zona / campaña 3.2 Superficie de cultivos / zona", " 2 Zonas de análisis pacman::p_load(tidyverse, sf) # acondicionar vista de mapa theme_set(theme_bw()+ theme( panel.grid.major = element_line(color = gray(0.5), linetype = &quot;dashed&quot;, size = 0.05), panel.background = element_rect(fill = &quot;aliceblue&quot;), axis.text.x = element_text(size = 6), axis.text.y = element_text(size = 6), )) #provincias argentinas ARG &lt;- raster::getData(name = &quot;GADM&quot;, country = &quot;ARG&quot;, level = 0) %&gt;% st_as_sf() #municipios de Buenos Aires BSAS &lt;- raster::getData(name = &quot;GADM&quot;, country = &quot;ARG&quot;, level = 2) %&gt;% st_as_sf() %&gt;% filter(NAME_1 == &quot;Buenos Aires&quot;) # unique(BSAS$NAME_2) # crear zonzas a partir de municipios que se incluyen BSAS %&gt;% mutate(Zona = case_when( str_detect(NAME_2, &quot;Madariaga|Maipú|Chiquita|Ayacucho&quot;) ~ &quot;Madariaga&quot;, str_detect(NAME_2, &quot;Balcarce|Lober&quot;) ~ &quot;Sierra&quot;, str_detect(NAME_2, &quot;Pueyrre|Alvarado&quot;) ~ &quot;Costa&quot;)) %&gt;% drop_na(Zona) %&gt;% mutate(id = gsub(&quot;[^A-Z]+&quot;, &quot;&quot;, .$NAME_2)) -&gt; jmf jmf &lt;- cbind(jmf, st_coordinates(st_centroid(jmf$geometry))) %&gt;% mutate(has = st_area(geometry)/10000) jmf %&gt;% group_by(Zona) %&gt;% summarise(has = sum(has)) ARG %&gt;% ggplot()+ geom_sf()+ geom_sf(data = BSAS, fill = &quot;gray98&quot;, color= &quot;gray60&quot;, size =0.2) + geom_sf(data = jmf, aes(fill = Zona), color = gray(.1), size = 0.2) + coord_sf(xlim = c(-60,-56.5), ylim = c(-39, -36), expand = FALSE, label_axes = waiver())+ geom_text(data = jmf, aes(x = X, y = Y, label = id), size = 3, hjust = 0.5, fontface = &quot;bold&quot;)+ labs(x = &quot;&quot;, y = &quot;&quot;) # ggsave(last_plot(), file = &quot;plots/zonas.png&quot;, w=6, h=6) # drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/zonas.png&quot;, overwrite = TRUE) zonas-JMF 3 Superficies knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE) pacman::p_load(tidyverse, googlesheets4, googledrive) # drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) source(here::here(&quot;0 themes.R&quot;)) load(here::here(&quot;data/data.Rdata&quot;)) # glimpse(dat) 3.1 Superficie por zona / campaña (dat %&gt;% group_by(Zona, campana) %&gt;% summarise(super = round(sum(superficie, na.rm = TRUE)/1000,1)) %&gt;% ungroup() %&gt;% mutate(campana = factor(campana), # campana = forcats::fct_rev(campana), zona = factor(Zona)) %&gt;% ggplot(aes( x = campana, # x = reorder(Zona, super, sum), y = super, fill = Zona)) + geom_bar(stat = &quot;identity&quot;, color = gray(.5)) + geom_text(aes(label = super), position = position_stack(vjust = 0.5), col = &quot;white&quot;, fontface = &quot;bold&quot;, size = 4)+ # coord_flip()+ labs(x = &quot;&quot;, y = &quot;miles de has&quot;, fill = &quot;&quot;, title = &quot;Superficie según campaña/zona&quot;)+ geom_text( aes( # x = reorder(Zona, super, sum), x = campana, label = stat(y), group = campana), stat = &#39;summary&#39;, fun = sum, angle = 0, vjust = -0.5, hjust=0.5, size = 4)+ scale_fill_viridis_d(begin = 0.3, end =1, direction = -1)+ lims(y=c(0,17))+ theme_bw2 ) ggsave(last_plot(), file = &quot;plots/sup_campana_zona.png&quot;, width = 7, height = 4) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/sup_campana_zona.png&quot;, overwrite = TRUE) 3.2 Superficie de cultivos / zona (dat %&gt;% filter(campana == &quot;20-21&quot;) %&gt;% group_by(Zona, cultivo_de_cosecha) %&gt;% summarise(super = round(sum(superficie)/1000,1)) %&gt;% ungroup() %&gt;% mutate(Zona = factor(Zona), # campana = forcats::fct_rev(campana), cultivo_de_cosecha = factor(cultivo_de_cosecha)) %&gt;% filter(between(super, 0.1, 10000)) %&gt;% ggplot(aes( x =reorder(Zona, super, sum), y = super, fill = cultivo_de_cosecha)) + geom_bar(stat = &quot;identity&quot;, color = gray(.5)) + geom_text(aes(label = super), position = position_stack(vjust = 0.5), col = &quot;white&quot;, fontface = &quot;bold&quot;, size = 4)+ coord_flip()+ labs(x = &quot;&quot;, y = &quot;miles de has&quot;, fill = &quot;&quot;, title = &quot;Superficie de cultivos en 2020-21&quot;)+ geom_text( aes(x = reorder(Zona, super, sum), label = stat(y), group = Zona), stat = &#39;summary&#39;, fun = sum, angle = 270, vjust = -0.3, hjust=0.5, size = 4)+ scale_fill_viridis_d(begin = 0.3, end =1, direction = -1)+ theme_bw2 ) ggsave(last_plot(), file = &quot;plots/sup_cultivos.png&quot;, width = 7, height = 4) drive_upload(path = as_dribble(&quot;juanchi_guille/JMF_fina_2020&quot;), &quot;plots/sup_cultivos.png&quot;, overwrite = TRUE) "]]
